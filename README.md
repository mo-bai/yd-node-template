## 构建 AWS 数据库

1. 直接使用 数据库-aurora and RDS 创建一个数据库
2. 测试数据库配置流程
   2.1 先创建一个自定义的安全组，添加出入站规则，允许所有流量和 ip 地址（仅限开发 demo 环境，用于学习）
   2.2 创建新的数据库，按照页面一个个配置，下面仅列出初始有歧义的配置
   2.2.1 引擎类型：Aurora (PostgreSQL Compatible) 和 PostgreSQL 理论上都可以，但是 PostgreSQL 提供免费套餐，以下都是基于此配置的
   2.2.2 模板：直接选免费的就行
   2.2.3 数据库实例标识符：自定义，可以随意取名，但是需要全局唯一，和需要连接的数据库名称不是一个东西
   2.2.4 VPC：选择自定义安全组所在的 VPC 即可，默认的安全组不可编辑，后面想变动很麻烦
   2.2.5 安全组：选择自定义安全组
   2.2.6 公开访问：即是否可以通过共有网络访问，开发 demo 环境选择【是】，生产环境选择【否】
   2.2.7 其他配置：展开【其他配置】，可以看到【初始数据库名称】，这里填了就会初始化对应的数据库，不填则是默认数据库
   2.3 都配置完点击创建即可
3. 连接数据库
   3.1 点击数据库菜单：在数据库实例的列表中进入数据库详情页
   3.2 由于上面是按照开发 demo 来创建的，那么使用 navicat 测试连接可以按以下信息设置
   3.2.1 连接名：任意取
   3.2.2 主机：数据库实例的【终端节点】
   3.2.3 用户名： 配置时设置的用户名
   3.2.4 密码： 配置时设置的密码，如果配置时选择自动生成，则创建完成后，在页面顶部会有 tip 显示，点击 tip 就会展示密码
   3.2.5 初始数据库：配置时设置的初始数据库名称，没填则是默认数据库，postgreSQL 就是 postgres
   3.3 点击测试连接，如果连接成功，则可以点击右下角的【完成】
   3.4 点击右下角的【完成】后，会自动跳转到数据库详情页，点击【连接】，即可看到连接成功的信息
   3.5 点击【连接】后，会自动跳转到数据库详情页，点击【连接】，即可看到连接成功的信息

## 项目部署 ec2

1. 上传项目到 ec2
2. 安装项目依赖
3. 安装 pm2
4. 执行 build 命令生成 prismaClient
5. 使用 pm2 启动项目 `pm2 start ecosystem.config.js `

### pm2 问题

1. pm2 频繁重启项目，需要关闭 pm2 的 watch 功能
2. 可以直接使用 npm 命令，免除 ts-node 相关的内容依赖
3. 如果 pm2 启动失败且因为配置的问题，一定要先删除 pm2 中的项目，再启动新的
4. 可能存在内存的 pm2 和 执行的 pm2 不一致的问题，需要手动更新 pm2（pm2 update）
